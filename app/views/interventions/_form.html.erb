<%= form_with(model: intervention, local: true) do |form| %>
  <% if intervention.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(intervention.errors.count, "error") %> prohibited this intervention from being saved:</h2>

      <ul>
      <% intervention.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>



  <%#Customer dropdown list %>
  <div class="field">
    <%= form.label :customerID %>
  </div>
  <div class="field" id="customer">
    <%= form.select(:customerID) do %>
    <% @customer.each do |l| -%>
    <%= content_tag(:option, l.Company_Name, value: l.id) %>
    <% end %>
    <% end %>
  </div>

  <%#Building dropdown list %>
  <div class="field">
    <%= form.label :Building_ID %>
    <div id = "building">
    </div>
  </div>
  <%= form.select(:building_id) do %>
  <% @building.each do |l| -%>
  <%= content_tag(:option, l.adress_id, value: l.id) %>
  <% end %>
  <% end %>

  <div class="field" id="building_type" onchange="selectBuildingType()">
    <% building_type_options = [["--select--","select"], ["Residential", "residential"], ["Commercial", "commercial"], ["Corporate", "corporate"], ["Hybrid", "hybrid"]]%>
    <%= form.label :building_type %>
    <%# select_tag :building_type, options_for_select(building_type_options) %>
    <div onchange="selectBuildingType()" >
    <%= form.select(:building_type, options_for_select(building_type_options)) %>
    </div>
  </div>

  <div class="field">
    <%= form.label :author %>
    <%= form.text_field :author %>
  </div>

  <div class="field">
    <%= form.label :customerID %>
    <%= form.text_field :customerID %>
  </div>

  <div class="field">
    <%= form.label :buildingID %>
    <%= form.text_field :buildingID %>
  </div>

  <div class="field">
    <%= form.label :batteryID %>
    <%= form.text_field :batteryID %>
  </div>

  <div class="field">
    <%= form.label :columnID %>
    <%= form.text_field :columnID %>
  </div>

  <div class="field">
    <%= form.label :elevatorID %>
    <%= form.text_field :elevatorID %>
  </div>

  <div class="field">
    <%= form.label :employeeID %>
    <%= form.text_field :employeeID %>
  </div>

  <div class="field">
    <%= form.label :startDateAndTimeOfIntervention %>
    <%= form.datetime_select :startDateAndTimeOfIntervention %>
  </div>

  <div class="field">
    <%= form.label :endDateAndTimeOfIntervention %>
    <%= form.datetime_select :endDateAndTimeOfIntervention %>
  </div>

  <div class="field">
    <%= form.label :result %>
    <%= form.text_field :result %>
  </div>

  <div class="field">
    <%= form.label :report %>
    <%= form.text_area :report %>
  </div>

  <div class="field">
    <%= form.label :status %>
    <%= form.text_field :status %>
  </div>

  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>

<script>
$(function() {
   $("#intervention_customer_id").change(function() {
    // var id_value_string = $(this).val();
    // if (id_value_string == "") {
    //  $("select#building option").remove();
    //  var row = "<option value=\"" + "" + "\">" + "Building" + "</option>";
    //  $(row).appendTo("select#building");
    // } else {
     // Send the request and update building dropdown
     $.ajax({
      dataType: "json",
      cache: false,
      url: '/get_buildings_by_customer/',
      timeout: 5000,
      error: function(XMLHttpRequest, errorTextStatus, error) {
       alert("Failed to submit : " + errorTextStatus + " ;" + error);
      },
      success: function(data) {
        console.log("Im here")
        console.log(data)
       //put in a empty default line
       var row = "<option value=\"" + "" + "\">" + "Building" + "</option>";
       $(row).appendTo("#building");
       // Fill building select
       $.each(data, function(i, j) {
        row = "<option value=\"" + j.id + "\">" + j.title + "</option>";
        $(row).appendTo("#building");
       });
      }
     });
   });

  });  
    
    
    
    
    
    
// Example of ajax code  : Need match in routes, and get method, controller logic to get the buildings.
    // $.ajax({
		// type: "GET",
		// url: url, 
		// contentType: "application/json; charset-utf-8",
		// dataType: "json",
		// success: function(data) {
		//   $('#zone').empty();
		//   $('#zone').append("<option value=''>- Select Zone-</option>");
		//   $.each(data, function(i,item){
		// 	var selecting=''; 
		// 	if ($('#dis').val().findIndex(x => x==data[i].id)>=0) {
		// 	  selecting = ' selected="selected"'; 
		// 	} else {
		// 	  selecting = '';
		// 	}
		// 	$('#zone').append('<option '+selecting+' value="'+data[i].id+'">'+data[i].name+'</optoin>');
		//   });
		// }, 
		// complete: function() {}
	  // }); 
</script>
